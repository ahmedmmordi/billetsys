<!--
  Eclipse Public License - v 2.0

    THE ACCOMPANYING PROGRAM IS PROVIDED UNDER THE TERMS OF THIS ECLIPSE
    PUBLIC LICENSE ("AGREEMENT"). ANY USE, REPRODUCTION OR DISTRIBUTION
    OF THE PROGRAM CONSTITUTES RECIPIENT'S ACCEPTANCE OF THIS AGREEMENT.
-->

{#include layout}
{#content}
<h1>Messages</h1>
<p><a href="/messages/new">New Message</a></p>
<style>
    .message-attachments td {
        padding: 0;
    }
    .attachment-footer {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 6px 10px;
        background: rgba(176, 0, 32, 0.06);
        border-top: 1px solid var(--table-border);
    }
    .attachment-meta {
        font-size: 12px;
        color: #5b5b5b;
        margin-left: auto;
        text-align: right;
    }
    .attachment-name {
        text-align: left;
    }
    .attachment-name a {
        color: #b00020;
        text-decoration: none;
        font-weight: 600;
    }
    .markdown-output p {
        margin: 0 0 6px 0;
    }
    .markdown-output p:last-child {
        margin-bottom: 0;
    }
    .markdown-output ul {
        margin: 0 0 6px 18px;
        padding: 0;
    }
    .markdown-output h1,
    .markdown-output h2,
    .markdown-output h3,
    .markdown-output h4,
    .markdown-output h5,
    .markdown-output h6 {
        margin: 0 0 6px 0;
        font-size: 14px;
    }
</style>
<table>
    <thead>
    <tr>
        <th>ID <button class="sort-button" type="button" onclick="sortTable(this, 0)">↕</button></th>
        <th>Body <button class="sort-button" type="button" onclick="sortTable(this, 1)">↕</button></th>
        <th>Date <button class="sort-button" type="button" onclick="sortTable(this, 2)">↕</button></th>
        <th>Ticket <button class="sort-button" type="button" onclick="sortTable(this, 3)">↕</button></th>
        <th>Author <button class="sort-button" type="button" onclick="sortTable(this, 4)">↕</button></th>
    </tr>
    </thead>
    <tbody>
    {#for message in messages}
    <tr>
        <td>{message.id}</td>
        <td>
            <div class="markdown-output">{message.body.markdown}</div>
        </td>
        <td>{message.date}</td>
        <td>{message.ticket.name}</td>
        <td>{#if message.author != null}<a href="mailto:{message.author.email}">{message.author.email}</a>{#else}-{/if}</td>
    </tr>
    {#if !message.attachments.isEmpty}
    <tr class="message-attachments">
        <td colspan="5">
            {#for attachment in message.attachments}
            <div class="attachment-footer">
                <span class="attachment-name">
                    <a href="/attachments/{attachment.id}" target="_blank" rel="noopener">{attachment.name}</a>
                </span>
                <span class="attachment-meta">{attachment.mimeType} - {attachment.sizeLabel}</span>
            </div>
            {/for}
        </td>
    </tr>
    {/if}
    {/for}
    </tbody>
</table>
{/content}
{/include}
